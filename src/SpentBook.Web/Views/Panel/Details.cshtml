@model SpentBook.Web.Models.PanelModel

<div class="panel-heading clearfix">
    <h4 class="panel-title pull-left">@Model.Title</h4>

    <div class="btn-group pull-right panel-actions">
        <button type="button" class="btn btn-default btn-xs btn-edit">
            <span class="glyphicon glyphicon-edit" aria-hidden="true">
                @Html.ActionLink("edit", "Edit", "Panel", new { dashboardId = @Model.Dashboard.Id, panelId = Model.Id }, new { @class = "collapse" })
            </span>
        </button>

        <button type="button" class="btn btn-default btn-xs btn-delete">
            <span class="glyphicon glyphicon-trash" aria-hidden="true">
                @Html.ActionLink("delete", "Delete", "Panel", new { dashboardId = @Model.Dashboard.Id, panelId = Model.Id }, new { @class = "collapse" })
            </span>
        </button>
    </div>
</div>

<div class="panel-body">
    <ul class="nav nav-pills nav-justified">
        @{
            var activeTab = "active";
        }
        @if (Model.PanelComponents.HasFlag(SpentBook.Domain.PanelComponents.Chart) && Model.PanelComponents != SpentBook.Domain.PanelComponents.Chart)
        {
            <li class="@activeTab"><a data-toggle="tab" href="#chart-@Model.Id">Gráfico</a></li>
            activeTab = "";
        }

        @if (Model.PanelComponents.HasFlag(SpentBook.Domain.PanelComponents.Table) && Model.PanelComponents != SpentBook.Domain.PanelComponents.Table)
        {
            <li class="@activeTab"><a data-toggle="tab" href="#table-@Model.Id">Tabela</a></li>
            activeTab = "";
        }
    </ul>

    <div class="tab-content">
        @{
            var activeContent = "in active";
        }
        @if (Model.PanelComponents.HasFlag(SpentBook.Domain.PanelComponents.Chart))
        {
            <div id="chart-@Model.Id" class="tab-pane fade in @activeContent">
                @switch (Model.Panel.GetDataType())
                {
                    case SpentBook.Domain.Panel.PanelDataType.NonGroup:
                    case SpentBook.Domain.Panel.PanelDataType.NonGroupAndSortDate:
                        @Html.Partial("~/Views/Templates/Charts/Lines.cshtml", Model)
                        break;
                    case SpentBook.Domain.Panel.PanelDataType.OneGroup:
                    case SpentBook.Domain.Panel.PanelDataType.TwoGroup:
                    case SpentBook.Domain.Panel.PanelDataType.ThreeOrMoreGroup:
                    @Html.Partial("~/Views/Templates/Charts/Columns.cshtml", Model)
                        break;
                }

                <div class="content-chart">

                </div>
            </div>
            
            activeContent = "";
        }
        
        @if (Model.PanelComponents.HasFlag(SpentBook.Domain.PanelComponents.Table))
        {   
            <div id="table-@Model.Id" class="tab-pane fade @activeContent">
                <script language="javascript">
                    $(document).ready(function () {
                        $.ajax({
                            url: '/JsonData/TransactionsTable',
                            type: "GET",
                            dataType: "json",
                            data: { dashboardId: '@Model.Dashboard.Id', panelId: '@Model.Id', tryCategorize: false },
                            success: function (json) {
                                var wrapper = $('#table-@Model.Id .content-table');
                                wrapper.html(json.Table);
                                wrapper.find("table").treegrid();
                            },
                            cache: false
                        });
                    });
                </script>

                <div class="content-table">

                </div>
            </div>
            
            activeContent = "";
        }
</div>

@section ScriptsTop {
    @Scripts.Render("~/bundles/jquery-treegrid")
    @Scripts.Render("~/bundles/highcharts")
    @Scripts.Render("~/bundles/custom/highcharts-helper")
}

@section styles {
    @Styles.Render("~/Content/css/treegrid")
}